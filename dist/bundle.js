(()=>{"use strict";let t=location.href;function e(t,e){const n=function(t){const e=document.createElement("form");e.setAttribute("id","my-form"),e.setAttribute("autocomplete","off");const n=document.createElement("textarea");n.setAttribute("id","msg"),n.setAttribute("name","msg"),n.setAttribute("required",""),n.setAttribute("placeholder","כתוב הודעה בקיר הזה בעזרת StipsXtra: "),n.setAttribute("style","width: 75%;"),t&&n.setAttribute("style",n.getAttribute("style")+"background-color: #2c2c2c;color: white;"),e.appendChild(n);const s=document.createElement("button");s.setAttribute("type","submit"),t&&s.setAttribute("style","background-color: #2c2c2c;");const o=document.createElement("img");return o.setAttribute("src",t?"https://img.icons8.com/ios-filled/34/ffffff/paper-plane.png":"https://img.icons8.com/ios-filled/34/000000/paper-plane.png"),o.setAttribute("alt","send"),s.appendChild(o),e.appendChild(s),e}(e);t.insertBefore(n,t.firstChild),n.addEventListener("submit",(function(t){t.preventDefault(),function(t,e){const n="name=omniobj&rest_action=PUT&omniobj="+encodeURIComponent(JSON.stringify({data:{msg:t,touserid:e},objType:"thanksmsg"})),s=new XMLHttpRequest;s.open("POST","https://stips.co.il/api"),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),s.send(n)}(document.getElementById("msg").value,location.href.split("/").at(-1)),window.location.reload()}))}function n(t,e){const n=[],s=[];e.forEach((t=>{const e=t.data;n.push((e.votes_score+e.votes_count)/2),s.push((e.votes_count-e.votes_score)/2)})),Array.from(t.childNodes).filter((t=>t.classList&&t.classList.contains("list-single-item"))).forEach(((t,e)=>{t.querySelector(".score").innerHTML=n[e];const o=t.querySelector(".votesArea"),c=o.childNodes[1],i=c.attributes[0].name;o.insertBefore(function(t,e){const n=document.createElement("span");return n.textContent=t,n.setAttribute(e,""),n.classList.add("score"),n}(s[e],i),c)}))}function s(){const t=location.pathname;chrome.storage.sync.get({darkmode:!0,"self-message":!0,"full-votes":!0},(function(s){var o;s.darkmode&&((o=document.createElement("link")).rel="stylesheet",o.href=chrome.runtime.getURL("src/styles/darkmode.css"),document.head.appendChild(o)),s["self-message"]&&t.startsWith("/profile/")&&function(t){const e=arguments[1],n=new MutationObserver((function(){if(document.querySelector(".items-container")){const s=document.querySelector("app-thankswall"),o=s.childNodes;Array.from(o).find((t=>t.classList&&t.classList.contains("add-item")&&t.classList.contains("ng-star-inserted")))||t(s,e),n.disconnect()}}));n.observe(document.documentElement,{childList:!0,subtree:!0})}(e,s.darkmode),s["full-votes"]&&t.startsWith("/ask/")&&async function(t){const e="name=objectlist&api_params="+encodeURIComponent(JSON.stringify({askid:t,method:"ans.for_item",page:1})),n=await fetch("https://stips.co.il/api",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",accept:"application/json"},body:e});return await n.json()}(t.split("/").at(2)).then((t=>{!function(t){const e=arguments[1],n=new MutationObserver((function(){const s=document.querySelector(".no-results-msg"),o=document.querySelector(".response-count-title");if(s||o){const s=document.querySelector("app-item-list");t(s,e),n.disconnect()}}));n.observe(document.documentElement,{childList:!0,subtree:!0})}(n,t.data)}))}))}chrome.storage.sync.get({universal_switch:!0},(function(e){var n;e.universal_switch&&(s(),n=s,new MutationObserver((()=>{const e=location.href;e!==t&&(t=e,n())})).observe(document,{subtree:!0,childList:!0}))}))})();